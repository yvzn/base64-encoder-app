<Window x:Class="Base64Utils.MainWindow"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:local="clr-namespace:Base64Utils"
xmlns:converters="clr-namespace:Base64Utils.Converters"
xmlns:behaviors="clr-namespace:Base64Utils.Behaviors"
mc:Ignorable="d"
Title="Base64 Converter" Height="600" Width="800"
Icon="/Assets/favicon.ico"
>
    <Window.Resources>
        <!-- Font Family -->
        <FontFamily x:Key="MainFont">Assets/#Atkinson Hyperlegible Next</FontFamily>
        
        <!-- Converters -->
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBoolConverter"/>
        <converters:BooleanToCursorConverter x:Key="BoolToCursorConverter"/>
        
        <!-- https://colorhunt.co/palette/40a2e3fff6e9bbe2ec0d9276 -->
        <Color x:Key="EncodeAccentColor">#40A2E3</Color>
        <Color x:Key="DecodeAccentColor">#0D9276</Color>
        <Color x:Key="ErrorAccentColor">#F93943</Color>
        <SolidColorBrush x:Key="EncodeAccentBrush" Color="{StaticResource EncodeAccentColor}"/>
        <SolidColorBrush x:Key="DecodeAccentBrush" Color="{StaticResource DecodeAccentColor}"/>
        <SolidColorBrush x:Key="ErrorAccentBrush" Color="{StaticResource ErrorAccentColor}"/>
        
        
        <!-- Enhanced focus visual style for better visibility -->
        <Style x:Key="EnhancedFocusButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle">
                <Setter.Value>
                    <Style>
                        <Setter Property="Control.Template">
                            <Setter.Value>
                                <ControlTemplate>
                                    <Rectangle Margin="-5" 
                                             StrokeThickness="2" 
                                             Stroke="#999999"
                                             StrokeDashArray="1 1"
                                             SnapsToDevicePixels="True"/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Showcase Button Style - highlights the next action -->
        <Style x:Key="ShowcaseButtonStyle" TargetType="Button" BasedOn="{StaticResource EnhancedFocusButtonStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ShowcasedButton}" Value="{x:Null}">
                    <Setter Property="FontWeight" Value="Normal"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid TextElement.FontFamily="{StaticResource MainFont}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="32"/>
        </Grid.RowDefinitions>

        <TabControl x:Name="ModeTabControl"
                    Grid.Row="0"
                    Margin="10,10,10,10"
                    SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">
            <TabItem x:Name="EncodeTab">
                <TabItem.InputBindings>
                    <KeyBinding Key="C" Modifiers="Control" Command="{Binding CopyToClipboardCommand}"/>
                </TabItem.InputBindings>
                <TabItem.Header>
                    <StackPanel>
                        <Rectangle Height="4" Fill="{StaticResource EncodeAccentBrush}" RadiusX="0" RadiusY="0"/>
                        <TextBlock Text="Encode" FontSize="14" Margin="0,6,0,0" FontWeight="SemiBold"/>
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Top" Width="700" Margin="10">
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button x:Name="SelectFileButton" 
                                    Grid.Column="0"
                                    Content="Select File" 
                                    Height="40" 
                                    Width="120"
                                    Margin="0,0,10,0"
                                    FontSize="16"
                                    Command="{Binding SelectFileCommand}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="SelectFile">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <TextBlock x:Name="FileNameTextBlock" 
                                       Grid.Column="1"
                                       Text="{Binding FileNameDisplay}" 
                                       VerticalAlignment="Center"
                                       Margin="10,0"
                                       FontSize="14"
                                       TextWrapping="Wrap"
                                       TextTrimming="CharacterEllipsis"/>
                            
                            
                            <Button x:Name="ConvertButton" 
                                    Grid.Column="3"
                                    Content="Encode to Base64" 
                                    Height="40" 
                                    Width="160"
                                    Margin="0"
                                    FontSize="16"
                                    IsEnabled="{Binding IsConvertButtonEnabled}"
                                    Command="{Binding ConvertToBase64Command}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="Convert">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <Grid Margin="10,20,10,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0"
                                       Text="Result:" 
                                       FontSize="14"
                                       FontWeight="Bold"
                                       VerticalAlignment="Center"/>
                            
                            <Button x:Name="SaveToFileButton"
                                    Grid.Column="2"
                                    Content="{Binding SaveToFileButtonText}"
                                    Height="30"
                                    Width="120"
                                    Margin="0,0,10,0"
                                    FontSize="12"
                                    IsEnabled="{Binding IsSaveToFileButtonEnabled}"
                                    Command="{Binding SaveToFileCommand}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="SaveToFile">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <Button x:Name="CopyButton"
                                    Grid.Column="3"
                                    Content="{Binding CopyButtonText}"
                                    Height="30"
                                    Width="140"
                                    FontSize="12"
                                    IsEnabled="{Binding IsCopyButtonEnabled}"
                                    Command="{Binding CopyToClipboardCommand}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="Copy">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <!-- Result Display Block -->
                        <Border x:Name="EncodeResultBlock"
                                Margin="10"
                                Padding="15"
                                BorderBrush="#FFCCCCCC"
                                BorderThickness="2"
                                CornerRadius="4"
                                Background="#FFF9F9F9"
                                Visibility="{Binding IsEncodeResultVisible, Converter={StaticResource BoolToVisConverter}}">
                            <StackPanel>
                                <TextBlock x:Name="EncodeResultTitle"
                                           Text="✓ Encoding Successful"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="#FF0D9276"
                                           Margin="0,0,0,10"/>
                                <TextBlock x:Name="EncodeResultInfo"
                                           Text="{Binding EncodeResultInfo}"
                                           FontSize="14"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"/>
                                <TextBlock Text="Preview (first 100 characters):"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Margin="0,10,0,5"/>
                                <TextBox x:Name="EncodePreviewTextBox"
                                         Height="24"
                                         IsReadOnly="True"
                                         FontFamily="Consolas"
                                         FontSize="11"
                                         VerticalScrollBarVisibility="Hidden"
                                         HorizontalScrollBarVisibility="Hidden"
                                         TextWrapping="NoWrap"
                                         Background="White"
                                         BorderBrush="#FFCCCCCC"
                                         Padding="5,4"
                                         Text="{Binding EncodePreview, Mode=OneWay}"/>
                                <TextBlock Text="Use the buttons above to copy the complete Base64 string or save it to a file."
                                           FontSize="12"
                                           FontStyle="Italic"
                                           Foreground="#FF666666"
                                           Margin="0,10,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Error Display Block -->
                        <Border x:Name="EncodeErrorBlock"
                                Margin="10"
                                Padding="15"
                                BorderBrush="{StaticResource ErrorAccentBrush}"
                                BorderThickness="2"
                                CornerRadius="4"
                                Background="#FFFEF5F6"
                                Visibility="{Binding IsEncodeErrorVisible, Converter={StaticResource BoolToVisConverter}}">
                            <StackPanel>
                                <TextBlock x:Name="EncodeErrorTitle"
                                           Text="✗ Encoding Failed"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource ErrorAccentBrush}"
                                           Margin="0,0,0,10"/>
                                <TextBlock x:Name="EncodeErrorInfo"
                                           Text="{Binding EncodeErrorMessage}"
                                           FontSize="14"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"
                                           Foreground="#FF333333"/>
                                <TextBlock Text="Please check your input and try again."
                                           FontSize="12"
                                           FontStyle="Italic"
                                           Foreground="#FF666666"
                                           Margin="0,10,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem x:Name="DecodeTab">
                <TabItem.InputBindings>
                    <KeyBinding Key="V" Modifiers="Control" Command="{Binding PasteBase64Command}"/>
                </TabItem.InputBindings>
                <TabItem.Header>
                    <StackPanel>
                        <Rectangle Height="4" Fill="{StaticResource DecodeAccentBrush}" RadiusX="0" RadiusY="0"/>
                        <TextBlock Text="Decode" FontSize="14" Margin="0,6,0,0" FontWeight="SemiBold"/>
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Top" Width="700" Margin="10">
                        <!-- File Selection Section -->
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button x:Name="SelectBase64FileButton" 
                                    Grid.Column="0"
                                    Content="Select File" 
                                    Height="40" 
                                    Width="120"
                                    Margin="0,0,10,0"
                                    FontSize="16"
                                    Command="{Binding SelectBase64FileCommand}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="SelectBase64File">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <TextBlock x:Name="Base64FileNameTextBlock" 
                                       Grid.Column="1"
                                       Text="{Binding Base64FileNameDisplay}" 
                                       VerticalAlignment="Center"
                                       Margin="10,0"
                                       FontSize="14"
                                       TextWrapping="Wrap"
                                       TextTrimming="CharacterEllipsis"/>
                        </Grid>

                        <!-- Divider -->
                        <TextBlock Text="– OR –" 
                                   HorizontalAlignment="Center" 
                                   FontSize="12" 
                                   Foreground="#FF999999"
                                   Margin="0,10,0,10"
                                   FontWeight="SemiBold"/>

                        <!-- Paste Base64 String Section -->
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button x:Name="PasteBase64Button" 
                                    Grid.Column="0"
                                    Content="{Binding PasteBase64ButtonText}" 
                                    Height="30" 
                                    Width="140"
                                    Margin="0,0,10,0"
                                    FontSize="12"
                                    Command="{Binding PasteBase64Command}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="PasteBase64">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <TextBox x:Name="Base64PasteTextBox" 
                                     Grid.Column="1"
                                     Height="30"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Hidden"
                                     HorizontalScrollBarVisibility="Hidden"
                                     TextWrapping="NoWrap"
                                     Background="White"
                                     BorderBrush="#FFCCCCCC"
                                     BorderThickness="1"
                                     VerticalContentAlignment="Center"
                                     Padding="5,8"
                                     Text="{Binding Base64PastePreview, Mode=OneWay}"/>
                        </Grid>
                        
                        <Button x:Name="DecodeButton" 
                                Content="Decode Base64" 
                                Height="40" 
                                Width="160"
                                Margin="10,15,10,0"
                                FontSize="16"
                                HorizontalAlignment="Right"
                                IsEnabled="{Binding IsDecodeButtonEnabled}"
                                Command="{Binding DecodeBase64Command}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowcasedButton}" Value="Decode">
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Grid Margin="10,20,10,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0"
                                       Text="Result:" 
                                       FontSize="14"
                                       FontWeight="Bold"
                                       VerticalAlignment="Center"/>
                            
                            <Button x:Name="PreviewInBrowserButton"
                                    Grid.Column="2"
                                    Content="Preview in Browser"
                                    Height="30"
                                    Width="140"
                                    Margin="0,0,10,0"
                                    FontSize="12"
                                    IsEnabled="{Binding IsPreviewInBrowserEnabled}"
                                    Command="{Binding PreviewInBrowserCommand}"
                                    Style="{StaticResource ShowcaseButtonStyle}"/>
                            
                            <Button x:Name="SaveDecodedToFileButton"
                                    Grid.Column="3"
                                    Content="{Binding SaveDecodedButtonText}"
                                    Height="30"
                                    Width="120"
                                    Margin="0,0,0,0"
                                    FontSize="12"
                                    IsEnabled="{Binding IsSaveDecodedButtonEnabled}"
                                    Command="{Binding SaveDecodedFileCommand}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ShowcaseButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowcasedButton}" Value="SaveDecoded">
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Background" Value="{Binding AccentBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="behaviors:FocusBehavior.IsFocused" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <!-- Result Display Block -->
                        <Border x:Name="DecodeResultBlock"
                                Margin="10"
                                Padding="15"
                                BorderBrush="#FFCCCCCC"
                                BorderThickness="2"
                                CornerRadius="4"
                                Background="#FFF9F9F9"
                                Visibility="{Binding IsDecodeResultVisible, Converter={StaticResource BoolToVisConverter}}">
                            <StackPanel>
                                <TextBlock x:Name="DecodeResultTitle"
                                           Text="✓ Decoding Successful"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="#FF0D9276"
                                           Margin="0,0,0,10"/>
                                <TextBlock x:Name="DecodeResultInfo"
                                           Text="{Binding DecodeResultInfo}"
                                           FontSize="14"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"/>
                                <TextBlock Text="Use the button above to save the decoded binary content to a file."
                                           FontSize="12"
                                           FontStyle="Italic"
                                           Foreground="#FF666666"
                                           Margin="0,10,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Error Display Block -->
                        <Border x:Name="DecodeErrorBlock"
                                Margin="10"
                                Padding="15"
                                BorderBrush="{StaticResource ErrorAccentBrush}"
                                BorderThickness="2"
                                CornerRadius="4"
                                Background="#FFFEF5F6"
                                Visibility="{Binding IsDecodeErrorVisible, Converter={StaticResource BoolToVisConverter}}">
                            <StackPanel>
                                <TextBlock x:Name="DecodeErrorTitle"
                                           Text="✗ Decoding Failed"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource ErrorAccentBrush}"
                                           Margin="0,0,0,10"/>
                                <TextBlock x:Name="DecodeErrorInfo"
                                           Text="{Binding DecodeErrorMessage}"
                                           FontSize="14"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"
                                           Foreground="#FF333333"/>
                                <TextBlock Text="Please check your input and try again."
                                           FontSize="12"
                                           FontStyle="Italic"
                                           Foreground="#FF666666"
                                           Margin="0,10,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <StatusBar Grid.Row="1" Height="32" Background="#FFF5F5F5" FontFamily="{StaticResource MainFont}">
            <StatusBarItem>
                <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border x:Name="StatusBarAccent" Grid.Column="0" Width="4" CornerRadius="0" Background="{Binding AccentBrush, Mode=OneWay}"/>
                    <Grid Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="StatusBarText" Grid.Column="0"
                                   Text="{Binding StatusMessage, Mode=OneWay}" 
                                   Foreground="{Binding StatusForeground, Mode=OneWay}"
                                   FontSize="14"
                                   TextTrimming="CharacterEllipsis"
                                   Cursor="{Binding CanExpandStatusMessage, Converter={StaticResource BoolToCursorConverter}}"
                                   Focusable="True"
                                   behaviors:FocusBehavior.IsFocused="{Binding ShouldFocusStatusBar}"
                                   ToolTip="Press Enter or Space to expand message">
                            <TextBlock.InputBindings>
                                <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleStatusPopupCommand}"/>
                                <KeyBinding Key="Enter" Command="{Binding ToggleStatusPopupCommand}"/>
                                <KeyBinding Key="Space" Command="{Binding ToggleStatusPopupCommand}"/>
                            </TextBlock.InputBindings>
                        </TextBlock>
                        <ProgressBar x:Name="StatusProgress" Grid.Column="1"
                                     Width="140"
                                     Height="14"
                                     Margin="8,0,0,0"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisConverter}}"
                                     Foreground="{Binding AccentBrush, Mode=OneWay}"/>
                        <Popup x:Name="StatusMessagePopup"
                               PlacementTarget="{Binding ElementName=StatusBarText}"
                               Placement="Top"
                               AllowsTransparency="True"
                               StaysOpen="True"
                               IsOpen="{Binding IsStatusPopupOpen, Mode=TwoWay}">
                            <Border Background="White" 
                                BorderBrush="#FFCCCCCC" 
                                BorderThickness="1"
                                Padding="10"
                                MaxWidth="750"
                                CornerRadius="3"
                                TextElement.FontFamily="{StaticResource MainFont}">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                                </Border.Effect>
                                <Grid>
                                    <TextBox x:Name="ExpandedMessageText"
                                             Text="{Binding FullStatusMessage}"
                                             TextWrapping="Wrap"
                                             Foreground="#FF333333"
                                             FontSize="14"
                                             Margin="0,0,30,0"
                                             IsReadOnly="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Cursor="IBeam"
                                             VerticalScrollBarVisibility="Auto"
                                             HorizontalScrollBarVisibility="Disabled"/>
                                    
                                    <Button x:Name="ClosePopupButton"
                                            Content="✕"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Width="20"
                                            Height="20"
                                            Margin="0,-5,-5,-5"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Cursor="Hand"
                                            ToolTip="Press Escape or click to close"
                                            Command="{Binding CloseStatusPopupCommand}">
                                        <Button.InputBindings>
                                            <KeyBinding Key="Escape" Command="{Binding CloseStatusPopupCommand}"/>
                                        </Button.InputBindings>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Foreground" Value="#FF999999"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="#FFCC0000"/>
                                                        <Setter Property="Background" Value="#FFF0F0F0"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </Border>
                        </Popup>
                        <!-- Removed popup for simplification - status messages are now concise -->
                    </Grid>
                </Grid>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
